<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Catálogo</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
<style>
body{margin:0;font-family:Inter,Arial;background:#0f1724;color:#f8fafc;}
header{display:flex;align-items:center;padding:15px;background:#111827;}
header img{height:60px;margin-right:12px;}
header h1{font-size:28px;color:#3b82f6;}
.wrap{max-width:1100px;margin:20px auto;padding:0 12px;}
.search-bar{margin:12px 0;}
input,select{padding:8px;border-radius:8px;border:none;background:#0b1220;color:#fff;width:100%;}
.products{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px;}
.product{background:#111827;padding:12px;border-radius:12px;cursor:pointer;transition:0.3s;}
.product:hover{transform:scale(1.03);}
.product img{width:100%;height:180px;object-fit:contain;border-radius:8px;margin-bottom:6px;}
.product h3{font-size:16px;margin-bottom:4px;}
.product p{font-size:13px;color:#9ca3af;margin-bottom:4px;}
.price{font-weight:700;margin-bottom:6px;}
.add-cart{background:#06b6d4;color:#052022;padding:6px 10px;border-radius:8px;border:none;cursor:pointer;width:100%;}
#cartBtn{position:fixed;bottom:20px;right:20px;background:#3b82f6;color:#fff;border:none;border-radius:50%;width:60px;height:60px;font-size:24px;cursor:pointer;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 12px rgba(0,0,0,0.5);}
#cartModal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);display:none;align-items:center;justify-content:center;}
#cartContent{background:#111827;padding:20px;border-radius:12px;width:90%;max-width:500px;max-height:80%;overflow-y:auto;}
.cart-item{display:flex;justify-content:space-between;align-items:center;padding:8px;border-bottom:1px solid #222;}
.cart-item img{width:50px;height:50px;object-fit:contain;border-radius:6px;margin-right:6px;}
.cart-item div{flex:1;}
button{cursor:pointer;}
</style>
</head>
<body>

<header>
<img src="img/logo.png" alt="Logo">
<h1>Catálogo</h1>
</header>

<div class="wrap">
<input type="text" id="search" class="search-bar" placeholder="Buscar productos...">
<div class="products" id="productList"></div>
</div>

<button id="cartBtn"><i class="fa fa-shopping-cart"></i></button>

<div id="cartModal">
  <div id="cartContent">
    <h2>Carrito</h2>
    <div id="cartItems"></div>
    <div>Total: <span id="totalPrice">Q0.00</span></div>
    <label>Nombre cliente</label>
    <input id="clientName" placeholder="Ej: Juan Pérez">
    <label>Dirección / Observaciones</label>
    <textarea id="notes" rows="3" placeholder="Apto, barrio, hora..."></textarea>
    <button id="sendWhats" style="background:#06b6d4;padding:8px 12px;border-radius:8px;border:none;color:#052022;margin-top:8px;width:100%">Enviar por WhatsApp</button>
    <button id="closeCart" style="background:#ef4444;padding:8px 12px;border-radius:8px;border:none;color:#fff;margin-top:8px;width:100%">Cerrar</button>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
const PHONE="50241811434"; // tu número

const firebaseConfig = {
  apiKey: "AIzaSyCRzvwkeV8ceVnP5X2gA74a34iuClsc2qY",
  authDomain: "catalogo-f0b8e.firebaseapp.com",
  databaseURL: "https://catalogo-f0b8e-default-rtdb.firebaseio.com",
  projectId: "catalogo-f0b8e",
  storageBucket: "catalogo-f0b8e.firebasestorage.app",
  messagingSenderId: "100540032907",
  appId: "1:100540032907:web:a6acac793ff5c85884318e",
  measurementId: "G-PZK0757PMK"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let products=[]; let cart=[];

function currency(v){return 'Q'+v.toFixed(2);}

function loadProducts(){
  db.ref('products').once('value').then(snapshot=>{
    products=[];
    snapshot.forEach(s=>{products.push({...s.val(), id:s.key});});
    renderProducts();
  });
}

function renderProducts(){
  const list = document.getElementById('productList');
  const query = document.getElementById('search').value.toLowerCase();
  list.innerHTML='';
  products.forEach(p=>{
    if(p.name.toLowerCase().includes(query) || (p.category && p.category.toLowerCase().includes(query))){
      const div=document.createElement('div'); div.className='product';
      div.innerHTML=`<img src="${p.img}" alt="${p.name}"><h3>${p.name}</h3><p>${p.desc||''}</p><div>Precio: ${currency(p.price)}</div>${p.pack?'<div>Unidades por fardo: '+p.pack+'</div>':''}<input type="number" min="0.5" step="0.5" value="1" style="width:60px;margin-top:4px"><button class="add-cart">Agregar al carrito</button>`;
      div.querySelector('.add-cart').onclick=()=>{
        const qty=parseFloat(div.querySelector('input').value)||1;
        addToCart(p.id,qty);
      };
      list.appendChild(div);
    }
  });
}

function addToCart(id,qty){
  const existing=cart.find(x=>x.id===id);
  if(existing){existing.qty+=qty;}else{cart.push({id,qty});}
  renderCartItems();
}

function renderCartItems(){
  const container=document.getElementById('cartItems'); container.innerHTML='';
  let total=0;
  cart.forEach(item=>{
    const p=products.find(x=>x.id===item.id);
    if(!p) return;
    let subtotal=p.price*item.qty;
    let discount=0;
    if(p.discounts){Object.keys(p.discounts).sort((a,b)=>b-a).forEach(qty=>{if(item.qty>=parseFloat(qty))discount=p.discounts[qty];});}
    subtotal=subtotal*(1-discount);
    total+=subtotal;
    const div=document.createElement('div'); div.className='cart-item';
    div.innerHTML=`<img src="${p.img}"><div>${p.name} x ${item.qty}${discount?` (-${discount*100}%)`:""}<br>Subtotal: ${currency(subtotal)}</div><button onclick="removeFromCart('${item.id}')">Eliminar</button>`;
    container.appendChild(div);
  });
  document.getElementById('totalPrice').textContent=currency(total);
}

function removeFromCart(id){cart=cart.filter(x=>x.id!==id); renderCartItems();}

document.getElementById('cartBtn').onclick=()=>{document.getElementById('cartModal').style.display='flex';}
document.getElementById('closeCart').onclick=()=>{document.getElementById('cartModal').style.display='none';}

document.getElementById('sendWhats').onclick=()=>{
  if(cart.length===0){alert('Carrito vacío');return;}
  let text='Hola, quiero hacer un pedido:\n';
  const client=document.getElementById('clientName').value;
  const notes=document.getElementById('notes').value;
  if(client) text+='Cliente: '+client+'\n';
  cart.forEach(item=>{
    const p=products.find(x=>x.id===item.id);
    let subtotal=p.price*item.qty;
    let discount=0;
    if(p.discounts){Object.keys(p.discounts).sort((a,b)=>b-a).forEach(qty=>{if(item.qty>=parseFloat(qty))discount=p.discounts[qty];});}
    subtotal=subtotal*(1-discount);
    text+=`${item.qty} x ${p.name}${discount?` (-${discount*100}%)`:""} - Q${subtotal.toFixed(2)}\n`;
  });
  text+='Total: Q'+cart.reduce((t,it)=>{const p=products.find(x=>x.id===it.id); let subtotal=p.price*it.qty; let discount=0;if(p.discounts){Object.keys(p.discounts).sort((a,b)=>b-a).forEach(qty=>{if(it.qty>=parseFloat(qty))discount=p.discounts[qty];});} subtotal=subtotal*(1-discount); return t+subtotal;},0).toFixed(2)+'\n';
  if(notes) text+='Notas: '+notes+'\n';
  window.open(`https://wa.me/${PHONE}?text=${encodeURIComponent(text)}`,'_blank');
}

document.getElementById('search').addEventListener('input',()=>{renderProducts();});

loadProducts();
</script>
</body>
</html>
